-- Create table
create table ENROLLMENT_BONUS
(
  ebonus_seq                   NUMBER not null,
  source_code                  VARCHAR2(16 CHAR) not null,
  reference_code               VARCHAR2(16 CHAR),
  sdate                        DATE,
  enroll_bonus                 NUMBER,
  enroll_bonus_end             DATE,
  firstflight_bonus            NUMBER,
  firstflight_bonus_end        DATE,
  refmem_bonus                 NUMBER,
  refmem_bonus_end             DATE,
  refmem_firstflight_bonus     NUMBER,
  refmem_firstflight_bonus_end DATE,
  direct_enroll                VARCHAR2(20 CHAR),
  inserted_by                  VARCHAR2(20 CHAR),
  insert_date                  DATE,
  amended_by                   VARCHAR2(20 CHAR),
  amend_date                   DATE,
  enrol_tier_bonus             NUMBER,
  adjustment_code              VARCHAR2(10 CHAR),
  sub_program_code             VARCHAR2(3 CHAR),
  issue_credential             VARCHAR2(1) default 'F' not null,
  act_bonus_from_date          DATE,
  act_bonus_to_date            DATE,
  act_bonus_activity_count     NUMBER,
  act_bonus_points_fixed       NUMBER,
  act_bonus_points_percent     NUMBER,
  refmem_points_multiplier     NUMBER,
  refmem_multi_pnts_exp_months NUMBER
)
tablespace CRANE_PC_DATA
  pctfree 10
  initrans 1
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
-- Add comments to the table 
comment on table ENROLLMENT_BONUS
  is 'WHEN A MEMBER ENROLLS TO THE SYSTEM, WELCOME POINTS ARE GIVEN ACCORDING TO THE DEFINITIONS IN THIS TABLE';
-- Add comments to the columns 
comment on column ENROLLMENT_BONUS.ebonus_seq
  is 'Internal Sequence';
comment on column ENROLLMENT_BONUS.source_code
  is 'Source Code. FK FROM ENROLLMENT_SOURCES';
comment on column ENROLLMENT_BONUS.reference_code
  is 'Reference Code (Optional). FK FROM REFERENCE_CODES';
comment on column ENROLLMENT_BONUS.sdate
  is 'Start Date';
comment on column ENROLLMENT_BONUS.enroll_bonus
  is 'AWARD POINTS GIVEN FOR ENROLMENT';
comment on column ENROLLMENT_BONUS.enroll_bonus_end
  is 'Enrollment Welcome Miles End Date';
comment on column ENROLLMENT_BONUS.firstflight_bonus
  is 'First Flight Welcome Miles';
comment on column ENROLLMENT_BONUS.firstflight_bonus_end
  is 'First Flight Welcome Miles End Date';
comment on column ENROLLMENT_BONUS.refmem_bonus
  is 'Referring Member Enrollment Welcome Miles';
comment on column ENROLLMENT_BONUS.refmem_bonus_end
  is 'Referring Member Enrollment Welcome Miles End Date';
comment on column ENROLLMENT_BONUS.refmem_firstflight_bonus
  is 'Referring Member First Flight Welcome Miles';
comment on column ENROLLMENT_BONUS.refmem_firstflight_bonus_end
  is 'Referring Member First Flight Welcome Miles End Date';
comment on column ENROLLMENT_BONUS.direct_enroll
  is 'Direct Enrollment FK FROM FLYER_CARD_DEF';
comment on column ENROLLMENT_BONUS.inserted_by
  is 'USER WHO INSERTED THE RECORD (AUDITING PURPOSES)';
comment on column ENROLLMENT_BONUS.insert_date
  is 'INSERT DATE (AUDITING PURPOSES)';
comment on column ENROLLMENT_BONUS.amended_by
  is 'USER WHO AMENDED THE RECORD (AUDITING PURPOSES)';
comment on column ENROLLMENT_BONUS.amend_date
  is 'AMEND DATE (AUDITING PURPOSES)';
comment on column ENROLLMENT_BONUS.enrol_tier_bonus
  is 'TIER POINTS GIVEN FOR ENROLMENT';
comment on column ENROLLMENT_BONUS.adjustment_code
  is 'FK TO ADJUSTMENT_CODES.';
comment on column ENROLLMENT_BONUS.sub_program_code
  is 'Deafult Sub-Program Enrollment';
comment on column ENROLLMENT_BONUS.issue_credential
  is '''T'': ISSUE, ''F'': DO NOT ISSUE. SOME CARDS ARE PRESSED BEFORE ENROLMENT/ UPON ENROLLMENT ';
comment on column ENROLLMENT_BONUS.act_bonus_from_date
  is 'Referencing members will earn points from referred members activities from this date forward';
comment on column ENROLLMENT_BONUS.act_bonus_to_date
  is 'Referencing members will earn points from referred members activities till this date';
comment on column ENROLLMENT_BONUS.act_bonus_activity_count
  is 'Max number of times that mgm points can be earned. Can be earned from all activities if 0 or null';
comment on column ENROLLMENT_BONUS.act_bonus_points_fixed
  is 'Fixed points value that will be earned from each activity';
comment on column ENROLLMENT_BONUS.act_bonus_points_percent
  is 'Percent of activity points will be earned';
comment on column ENROLLMENT_BONUS.refmem_points_multiplier
  is 'Referencing members points multiplier. Multiplies ref mems current points';
comment on column ENROLLMENT_BONUS.refmem_multi_pnts_exp_months
  is 'Referencing members multipled points expiry months';
-- Create/Recreate primary, unique and foreign key constraints 
alter table ENROLLMENT_BONUS
  add constraint PK_EBONUS primary key (EBONUS_SEQ)
  using index 
  tablespace CRANE_PC_DATA
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table ENROLLMENT_BONUS
  add constraint UK_ENROLLMENT_BONUS unique (SOURCE_CODE, REFERENCE_CODE, ADJUSTMENT_CODE)
  using index 
  tablespace CRANE_PC_DATA
  pctfree 10
  initrans 2
  maxtrans 255
  storage
  (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
  );
alter table ENROLLMENT_BONUS
  add constraint FK#EB_ADJUSTMENT_CODE foreign key (ADJUSTMENT_CODE)
  references ADJUSTMENT_CODES (CODE)
  deferrable initially deferred;
alter table ENROLLMENT_BONUS
  add constraint FK#EBONUS_FCARDS_DEF foreign key (DIRECT_ENROLL)
  references FLYER_CARDS_DEF (ID)
  deferrable initially deferred;
alter table ENROLLMENT_BONUS
  add constraint FK#EB_REFERENCE_CODE foreign key (REFERENCE_CODE)
  references REFERENCE_CODES (CODE)
  deferrable initially deferred;
alter table ENROLLMENT_BONUS
  add constraint FK#EB_SOURCE_CODE foreign key (SOURCE_CODE)
  references ENROLLMENT_SOURCES (CODE)
  deferrable initially deferred;
-- Grant/Revoke object privileges 
grant select on ENROLLMENT_BONUS to CRANE_PC_BO;
grant select on ENROLLMENT_BONUS to CRANE_PC_RO;
